<!DOCTYPE html>
<html>
    <head>
        <style>
            /*######## Smart Green ########*/
            .smart-green {
                margin-left: 10px;
                margin-right: auto;
                max-width: 650px;
                background: #F8F8F8;
                padding: 30px 30px 20px 30px;
                font: 12px Arial, Helvetica, sans-serif;
                color: #666;
                border-radius: 5px;
                -webkit-border-radius: 5px;
                -moz-border-radius: 5px;
            }

            .smart-green h1 {
                font: 24px "Trebuchet MS", Arial, Helvetica, sans-serif;
                padding: 20px 0px 20px 40px;
                display: block;
                margin: -30px -30px 10px -30px;
                color: #FFF;
                background: #9DC45F;
                text-shadow: 1px 1px 1px #949494;
                border-radius: 5px 5px 0px 0px;
                -webkit-border-radius: 5px 5px 0px 0px;
                -moz-border-radius: 5px 5px 0px 0px;
                border-bottom: 1px solid #89AF4C;
            }

            .smart-green h1>span {
                display: block;
                font-size: 11px;
                color: #FFF;
            }

            .smart-green label {
                display: block;
                margin: 0px 0px 5px;
            }

            .smart-green label>span {
                float: left;
                margin-top: 10px;
                color: #5E5E5E;
            }

            .smart-green input[type="text"], .smart-green input[type="email"],
            .smart-green textarea, .smart-green select {
                color: #555;
                height: 30px;
                line-height: 15px;
                width: 100%;
                padding: 0px 0px 0px 10px;
                margin-top: 2px;
                border: 1px solid #E5E5E5;
                background: #FBFBFB;
                outline: 0;
                -webkit-box-shadow: inset 1px 1px 2px rgba(238, 238, 238, 0.2);
                box-shadow: inset 1px 1px 2px rgba(238, 238, 238, 0.2);
                font: normal 14px/14px Arial, Helvetica, sans-serif;
            }

            .smart-green textarea {
                height: 100px;
                padding-top: 10px;
            }

            .smart-green select {
                background: url('down-arrow.png') no-repeat right,
                    -moz-linear-gradient(top, #FBFBFB 0%, #E9E9E9 100%);
                background: url('down-arrow.png') no-repeat right,
                    -webkit-gradient(linear, left top, left bottom, color-stop(0%, #FBFBFB),
                    color-stop(100%, #E9E9E9));
                appearance: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                text-indent: 0.01px;
                text-overflow: '';
                width: 100%;
                height: 30px;
            }

            .smart-green .button {
                background-color: #9DC45F;
                border-radius: 5px;
                -webkit-border-radius: 5px;
                -moz-border-border-radius: 5px;
                border: none;
                padding: 10px 25px 10px 25px;
                color: #FFF;
                text-shadow: 1px 1px 1px #949494;
            }

            .smart-green .button:hover {
                background-color: #80A24A;
            }

            table.altrowstable {
                font-family: verdana, arial, sans-serif;
                font-size: 11px;
                color: #333333;
                border-width: 1px;
                border-color: #a9c6c9;
                border-collapse: collapse;
            }

            table.altrowstable th {
                border-width: 1px;
                padding: 8px;
                border-style: solid;
                border-color: #a9c6c9;
            }

            table.altrowstable td {
                border-width: 1px;
                padding: 8px;
                border-style: solid;
                border-color: #a9c6c9;
            }

            .oddrowcolor {
                background-color: #d4e3e5;
            }

            .evenrowcolor {
                background-color: #c3dde0;
            }


            .multiselect {
                width:20em;
                height:15em;
                border:solid 1px #c0c0c0;
                overflow:auto;
            }

            .multiselect label {
                display:block;
            }

            .multiselect-on {
                color:#ffffff;
                background-color:#000099;
            }


            table.hovertable {
                font-family: verdana,arial,sans-serif;
                font-size:11px;
                color:#333333;
                border-width: 1px;
                border-color: #999999;
                border-collapse: collapse;
            }
            table.hovertable th {
                background-color:#c3dde0;
                border-width: 1px;
                padding: 8px;
                border-style: solid;
                border-color: #a9c6c9;
            }
            table.hovertable tr {
                background-color:#d4e3e5;
            }
            table.hovertable td {
                border-width: 1px;
                padding: 8px;
                border-style: solid;
                border-color: #a9c6c9;
            }



        </style>
        <script>

            var cacheLocalTags = [];
            var localTagsObject = {tagCategory: "", tagString: "", tagSubCategory: ""};
            var initialValues = {Title: "", Description: "", ProductTags: null, CurrentProductState: "", PrductProviders: null};
            var available_colors = ["Red", "Green", "Blue", "Cyn", "Orange", "Purple", "Black"];
            var available_sizes = ["S", "M", "L", "XL", "XXL", "XXXL"];
            //prototype for clear the array values.
            Array.prototype.clear = function() {
                this.length = 0;
            };
            var datafromparent;
            var jsonObject;
            var providerUpdaterequest;
            var tagCreateRequest;
            var tagCreationReqeustCount = 0;
            var productTagAssociateReq;
            var appendtagToProduct;
            var tagObject = {tagCategory: "", tagString: "", tagSubCategory: ""};
            var tagArray = [];
            var tags;
            var tagRequest;
            var tagsArray = [];
            var curatorId;
            //for tags validation.
            var localTags = [];
            var curatorReview;
            var buttonValue;

            window.addEventListener("message", function(event) {

                var strings = event.data.split("##");
                tags = JSON.parse(strings[0]);
                for (var i = 0; i < tags.length; i++) {
                    console.log(tags[i].tagString);
                }
                datafromparent = strings[1]

                curatorReview = strings[2];
                cacheLocalTags.clear();
                jsonObject = JSON.parse(datafromparent);
               alert
                if (jsonObject.currentProductState == "CRAWLED") {
                    buttonValue = "Curate And Finish";
                } else {
                    buttonValue = "Review And Finish";
                }
               // initialValues.Title = jsonObject.title;
               // initialValues.Description = jsonObject.description;
               // initialValues.PrductProviders = jsonObject.productProviders
               // initialValues.ProductTags = jsonObject.productTags;

               // for (var i = 0; i < jsonObject.productTags.length; i++) {
                 //   localTagsObject.tagCategory = jsonObject.productTags[i].tagCategory;
                 //   localTagsObject.tagString = jsonObject.productTags[i].tagString;
                  //  localTagsObject.tagSubCategory = jsonObject.productTags[i].tagSubCategory;
                  //  cacheLocalTags.push(localTagsObject);
              //  }

                tagCreationReqeustCount = 0;
                tagArray.clear();
                afterLoadingThePopup();
            }, false);
            function dataloader() {


                var val = document.getElementById('divid');
                val.innerHTML = datafromparent;
                console.log(datafromparent);
            }
            function afterLoadingThePopup() {
                var jsonResponse = JSON.parse(datafromparent);
                document.getElementById('id_id').value = jsonResponse.id;
                document.getElementById('id_ownerAisleId').value = jsonResponse.ownerAisleId;
                document.getElementById('id_ownerProductListId').value = jsonResponse.ownerProductListId;
                document.getElementById('id_title').value = jsonResponse.title;
                document.getElementById('id_description').value = jsonResponse.description;
                document.getElementById('id_creatorID').value = jsonResponse.creatorId;
                document.getElementById('id_curatorID').value = jsonResponse.curatorId;
                document.getElementById('id_relatedProductIds').value = jsonResponse.relatedProductIds;
                document.getElementById('send_but_id').value = buttonValue;
                //method to call to set current product state...
                set_current_ProductState(jsonResponse.currentProductState);
                // document.getElementById('single_select_1').value = jsonResponse.currentProductState;


                document.getElementById('id_comments').value = jsonResponse.comments;
                document.getElementById('id_ratings').value = jsonResponse.ratings;
                // product tags..
                var product_tags = jsonResponse.productTags;
                for (var m = 0; m < product_tags.length; m++) {
                    var tag_obj = product_tags[m];

                    if (tag_obj === null || tag_obj === undefined) {
                        continue;
                    }

                    var tag_cat = tag_obj.tagCategory;
                    var tag_string = tag_obj.tagString;
                    var tag_sub_cat = tag_obj.tagSubCategory;

                    createTagReqAndAddTable(tag_cat, tag_string, tag_sub_cat, 0)

                }


                var images_array = jsonResponse.productImages;
                var tabl_div = document.getElementById('image_table_id');
                for (var i = 0; i < images_array.length; i++) {

                    var br0 = document.createElement('br');
                    var br1 = document.createElement('br');
                    tabl_div.appendChild(br0);
                    tabl_div.appendChild(br1);
                    var table = document.createElement('table');
                    table.className = "altrowstable";
                    table.setAttribute('width', '600')

                    var caption = document.createElement('caption');
                    caption.textContent = 'For The Image: ' + (i + 1);
                    table.appendChild(caption);
                    table.appendChild(getElemnt('id', images_array[i].id));
                    table.appendChild(getElemnt('ownerProductId', images_array[i].ownerProductId));
                    table.appendChild(getElemnt('externalURL', images_array[i].externalURL));
                    table.appendChild(getElemnt('internalURL', images_array[i].internalURL));
                    table.appendChild(getElemnt('originalHeight', images_array[i].originalHeight));
                    table.appendChild(getElemnt('originalWidth', images_array[i].originalWidth));
                    table.appendChild(getElemnt('modifiedHeight', images_array[i].modifiedHeight));
                    table.appendChild(getElemnt('modifiedWidth', images_array[i].modifiedWidth));
                    table.appendChild(getElemnt('modifiedWidth', images_array[i].modifiedWidth));
                    tabl_div.appendChild(table);
                }
                var product_provider_div = document.getElementById('product_providers_div_id');
                var providers_array = jsonResponse.productProviders;
                for (var i = 0; i < providers_array.length; i++) {
                    var br0 = document.createElement('br');
                    var br1 = document.createElement('br');
                    product_provider_div.appendChild(br0);
                    product_provider_div.appendChild(br1);
                    var table = document.createElement('table');
                    table.className = "altrowstable";
                    // table.style.width = '400px';


                    var caption = document.createElement('caption');
                    caption.textContent = 'For The Provider: ' + (i + 1);
                    table.appendChild(caption);
                    table.appendChild(getElemnt('id', providers_array[i].id, 'id_' + i));
                    table.appendChild(getElemnt('ownerProductId', providers_array[i].ownerProductId, 'ownerProductId_' + i));
                    table.appendChild(getElemnt('externalURL', providers_array[i].externalURL, 'externalURL_' + i));
                    table.appendChild(getElemnt('quantity', providers_array[i].quantity, 'quantity_' + i));
                    table.appendChild(getElemnt('currencyCode', providers_array[i].currencyCode, 'currencyCode_' + i));
                    table.appendChild(getElemnt('store', providers_array[i].store, 'store_' + i));
                    var availability_1 = getAvailability('availability', providers_array[i].availability, 'availability_' + i);
                    table.appendChild(availability_1);
                    table.appendChild(getElemnt('price', providers_array[i].price, 'price_' + i));
                    table.appendChild(add_Onsale_Boolean('onSale', providers_array[i].onSale, 'onSale_' + i));
                    table.appendChild(getElemnt('salePrice', providers_array[i].salePrice, 'salePrice_' + i));
                    table.appendChild(getElemnt('saleExpiryDate', providers_array[i].saleExpiryDate, 'saleExpiryDate_' + i));
                    var available_clrs = getAvailableColors('availableColors', providers_array[i].availableColors, 'availableColors_' + i, i);
                    table.appendChild(available_clrs);
                    var available_sizes_1 = getAvailableSizes('availableSizes', providers_array[i].availableSizes, 'availableSizes_' + i, i);
                    table.appendChild(available_sizes_1);
                    table.appendChild(getElemnt('availableAtZipCodes', providers_array[i].availableAtZipCodes, 'availableAtZipCodes_' + i));
                    product_provider_div.appendChild(table);
                }


                //Added Product Tags
                //  add_Product_Tags();
                add_Product_TagsNew();
            }

            function add_Onsale_Boolean(key, value, id) {
                var key_name = 'on_sale_values';

                var tr = document.createElement('tr');
                var th_key = document.createElement('th');
                th_key.textContent = key;
                tr.appendChild(th_key);
                var th = document.createElement('th');
                var td = document.createElement('td');
                td.style.width = 300;
                // sel.value = value;

                //    alert(value);
                // alert(value);
                var enums = ['true', 'false'];
                for (var i = 0; i < enums.length; i++) {

                    if (enums[i].indexOf(value) === 0) {
                        var o1 = getRadioButton(key_name, enums[i], true);
                        td.appendChild(o1);
                    } else {
                        var o1 = getRadioButton(key_name, enums[i], false);
                        td.appendChild(o1);
                    }

                }
                th.appendChild(td);
                tr.appendChild(th);
                return tr;
                return tr;
            }

            function add_Product_Tags() {
                //add provider tags
                var tag_category_array = new Array();
                var tag_string_array = new Array();
                var tag_substring_array = new Array();
                var tag_category_array_uniqueNames = [];
                var tag_string_array_uniqueNames = [];
                var tag_substring_array_uniqueNames = [];
                for (var k = 0; k < tags.length; k++) {
                    var vcat = tags[k].tagCategory;
                    var vstr = tags[k].tagString;
                    var vsubstr = tags[k].tagSubCategory;
                    if (vcat !== null && vcat !== undefined && vcat !== '') {
                        tag_category_array = tag_category_array.concat(vcat.split(','));
                    }
                    if (vstr !== null && vstr !== undefined && vstr !== '') {
                        tag_string_array = tag_string_array.concat(vstr.split(','));
                    }
                    if (vsubstr !== null && vsubstr !== undefined && vsubstr !== '') {
                        tag_substring_array = tag_substring_array.concat(vsubstr.split(','));
                    }
                }


                $.each(tag_category_array, function(i, el) {
                    if ($.inArray(el, tag_category_array_uniqueNames) === -1)
                        tag_category_array_uniqueNames.push(el);
                });
                $.each(tag_string_array, function(i, el) {
                    if ($.inArray(el, tag_string_array_uniqueNames) === -1)
                        tag_string_array_uniqueNames.push(el);
                });
                $.each(tag_substring_array, function(i, el) {
                    if ($.inArray(el, tag_substring_array_uniqueNames) === -1)
                        tag_substring_array_uniqueNames.push(el);
                });
                //set default values from backend

                var tagcatelement = document.getElementById('select_tagCategory');
                for (var i = 0; i < tag_category_array_uniqueNames.length; i++) {
                    tagcatelement.options[tagcatelement.options.length] = new Option(tag_category_array_uniqueNames[i], tag_category_array_uniqueNames[i], false, false);
                }

                var tagStringlement = document.getElementById('select_tagString');
                for (var i = 0; i < tag_string_array_uniqueNames.length; i++) {
                    tagStringlement.options[tagStringlement.options.length] = new Option(tag_string_array_uniqueNames[i], tag_string_array_uniqueNames[i], false, false);
                }

                var tagSubCatelement = document.getElementById('select_tagSubCategory');
                for (var i = 0; i < tag_substring_array_uniqueNames.length; i++) {
                    tagSubCatelement.options[tagSubCatelement.options.length] = new Option(tag_substring_array_uniqueNames[i], tag_substring_array_uniqueNames[i], false, false);
                }
                $("select").multiselect().multiselectfilter();
            }


            function add_Product_TagsNew() {

                var static_categoryNames = ["Product Type", "Occasion", "Product description"]
                //add provider tags
                var tag_category_array = new Array();
                var tag_string_array = new Array();
                var tag_category_array_uniqueNames = [];
                var tag_string_array_uniqueNames = [];
                var tag_substring_array_uniqueNames = [];
                for (var k = 0; k < tags.length; k++) {
                    var vcat = tags[k].tagCategory;
                    var vstr = tags[k].tagString;
                    if (vcat !== null && vcat !== undefined && vcat !== '') {
                        tag_category_array = tag_category_array.concat(vcat.split(','));
                        var list_tagstring_array = tag_string_array[vcat];
                        if (vstr !== null && vstr !== undefined && vstr !== '') {

                            if (list_tagstring_array !== undefined) {
                                list_tagstring_array.push(vstr);
                            } else {
                                list_tagstring_array = new Array();
                                list_tagstring_array.push(vstr);
                            }

                        }
                        // alert('ffffffirst:' + list_tagstring_array + "VVV:" + vcat);
                        tag_string_array[vcat] = list_tagstring_array;
                    }



                }


                $.each(tag_category_array, function(i, el) {
                    if ($.inArray(el, tag_category_array_uniqueNames) === -1)
                        tag_category_array_uniqueNames.push(el);
                });
                for (k = 0; k < static_categoryNames.length; k++) {
                    if (k === 0) {
                        var tagcatelement = document.getElementById('select_tagCategory');
                        var temp0 = tag_string_array[static_categoryNames[k]];
                        // tagcatelement.options[tagcatelement.options.length] = new Option('', '', false, false);
                        for (var i = 0; i < temp0.length; i++) {
                            tagcatelement.options[tagcatelement.options.length] = new Option(temp0[i], temp0[i], false, false);
                        }
                    }
                    if (k === 1) {
                        var tagStringlement = document.getElementById('select_tagString');
                        var temp1 = tag_string_array[static_categoryNames[k]];
                        //tagStringlement.options[tagStringlement.options.length] = new Option('', '', false, false);
                        for (var i = 0; i < temp1.length; i++) {
                            tagStringlement.options[tagStringlement.options.length] = new Option(temp1[i], temp1[i], false, false);
                        }
                    }
                    if (k === 2) {
                        var tagSubCatelement = document.getElementById('select_tagSubCategory');
                        var temp2 = tag_string_array[static_categoryNames[k]];
                        //  tagSubCatelement.options[tagSubCatelement.options.length] = new Option('', '', false, false);
                        for (var i = 0; i < temp2.length; i++) {
                            tagSubCatelement.options[tagSubCatelement.options.length] = new Option(temp2[i], temp2[i], false, false);
                        }
                    }
                }

                //set default values from backend
                $("select").multiselect({
                    selectedList: 4}).multiselectfilter();
            }

            function getElemnt(key, value, id) {
                var tr = document.createElement('tr');
                var th_key = document.createElement('th');
                th_key.textContent = key;
                tr.appendChild(th_key);
                var th_val = document.createElement('th');

                var input = document.createElement('input');
                input.value = value;
                input.type = 'text';
                input.id = id;
                th_val.appendChild(input);
                tr.appendChild(th_val);
                return tr;
            }



            function getAvailability(key, value, id) {
                var enums = ['IN_STOCK', 'OUT_OF_STOCK', 'EXCESS_INVENTORY', 'RUNNING_LOW', 'TEMPORARY_UNAVAILABLE', 'PERMANENTLY_UNAVAILABLE'];
                var valAvail = 'provider_Availability';
                var tr = document.createElement('tr');
                var th_key = document.createElement('th');
                th_key.textContent = key;
                tr.appendChild(th_key);
                var th = document.createElement('th');
                var td = document.createElement('td');

                var div = document.createElement('div');
                div.style.width = '400px';


                // sel.value = value;
                for (var i = 0; i < enums.length; i++) {

                    if (enums[i] === value) {
                        //  var o1 = new Option(enums[i], enums[i], false, true);
                        //  sel.options[sel.options.length] = o1;
                        var rdbtn = getRadioButton(valAvail, enums[i], true);
                        td.appendChild(rdbtn);
                    } else {
                        //    var o1 = new Option(enums[i], enums[i], false, false);
                        //  sel.options[sel.options.length] = o1;
                        var rdbtn = getRadioButton(valAvail, enums[i], false);
                        td.appendChild(rdbtn);
                    }

                }
                div.appendChild(td);
                th.appendChild(div);
                tr.appendChild(th);
                return tr;
            }


            function getAvailableColors(key, value, id, i) {


                var tr = document.createElement('tr');
                var th_key = document.createElement('th');
                th_key.textContent = key;
                tr.appendChild(th_key);
                var th_val = document.createElement('th');
                var input = document.createElement('input');
                input.value = value;
                input.type = 'text';
                input.id = id;
                th_val.appendChild(input);
                // tr.appendChild(th_val);
                //  var th = document.createElement('th');
                // th.style.width = '100px';
                var sel = document.createElement('select');
                sel.id = "color_selector_" + i;
                sel.style.width = "75px";
                sel.multiple = 'multiple';
                sel.onchange = function() {
                    var vl = $("#color_selector_" + i).val();

                    var current_val = document.getElementById(id).value;
                    // alert("111: "+vl.length);
                    if (vl != null && vl != undefined) {

                        if (current_val === '') {
                            document.getElementById(id).value = vl.toString();
                        }
                        else {

                            for (var k = 0; k < vl.length; k++) {
                                //  alert("222: "+vl[k]+" *****: "+current_val.indexOf(vl[k]) );           
                                if (current_val.indexOf(vl[k]) < 0) {
                                    document.getElementById(id).value = current_val + "," + vl[k];
                                }
                            }
                        }
                    }
                };
                available_colors.forEach(function(entry) {
                    var o1 = new Option(entry, entry, false, false);
                    sel.options[sel.options.length] = o1;
                });
                th_val.appendChild(sel);
                tr.appendChild(th_val);
                return tr;
            }

            function getAvailableSizes(key, value, id, i) {


                var tr = document.createElement('tr');
                var th_key = document.createElement('th');
                th_key.textContent = key;
                tr.appendChild(th_key);
                var th_val = document.createElement('th');
                var input = document.createElement('input');
                input.value = value;
                input.type = 'text';
                input.id = id;

                th_val.appendChild(input);
                //  tr.appendChild(th_val);
                //var th = document.createElement('th');
                var sel = document.createElement('select');
                sel.id = "sizes_selector_" + i;
                sel.style.width = "75px";
                sel.multiple = 'multiple';
                sel.onchange = function() {
                    var vl = $("#sizes_selector_" + i).val();

                    var current_val = document.getElementById(id).value;
                    // alert("111: "+vl.length);
                    if (vl != null && vl != undefined) {

                        if (current_val === '') {
                            document.getElementById(id).value = vl.toString();
                        }
                        else {

                            for (var k = 0; k < vl.length; k++) {
                                //  alert("222: "+vl[k]+" *****: "+current_val.indexOf(vl[k]) );           
                                if (current_val.indexOf(vl[k]) < 0) {
                                    document.getElementById(id).value = current_val + "," + vl[k];
                                }
                            }
                        }
                    }

                };
                available_sizes.forEach(function(entry) {
                    var o1 = new Option(entry, entry, false, false);
                    sel.options[sel.options.length] = o1;
                });
                th_val.appendChild(sel);
                tr.appendChild(th_val);
                return tr;
            }

            function  set_current_ProductState(value) {

                var product_state_sel = document.getElementById('single_select_1');
                if (jsonObject.currentProductState == 'CRAWLED') {
                    var enums = ['CURATED'];
                } else {
                    var enums = ['CURATED_AND_VERIFIED', 'NEEDS_RECURATION'];
                }
                // var enums = ['CRAWLED', 'CURATED', 'CURATED_AND_VERIFIED', 'NEEDS_RECURATION'];
                var td = document.createElement('td');
                var name = "current_product_status";

                for (var i = 0; i < enums.length; i++) {

                    if ('CRAWLED' === value) {
                        // alert('curated22: '+value);
                        var v = getRadioButton(name, enums[i], true);
                        td.appendChild(v);

                    } else {
                        var v = getRadioButton(name, enums[i], false);
                        td.appendChild(v)
                    }

                }

                product_state_sel.appendChild(td);

            }

            function getRadioButton(name, text, status) {

                var label = document.createElement('label');
                label.textContent = text;

                var input = document.createElement('input');
                input.type = 'radio';
                input.name = name;
                input.value = text;
                input.textContent = text;
                input.checked = status;
                label.appendChild(input);


                label.appendChild(input);

                return label;
            }

            function getCuratedInfo() {
                var title = document.getElementById("id_title").value;
                var description = document.getElementById("id_description").value;
                  var checkedVal = document.querySelector('input[name="current_product_status"]:checked');
 
               if(checkedVal == null){
                     alert("Please Check ProductState");
                     return false;
               } 

                if (title == undefined || title.length < 1) {
                    showAlert("Please fill the title");
                    return false;
                }
                jsonObject.title = title;

                if (description === undefined || description.length < 1) {
                    showAlert("Please fill the description");
                    return false;
                }
                jsonObject.description = description;


                if (localTags.length < 3) {
                    showAlert("Please create minimum 3 Tags.");
                    return false;
                }

                
                return true;

            }
            function showAlert(message) {
                alert(message);
            }
            function curateProduct() {
                if (!getCuratedInfo()) {
                    return;
                }
                var title = document.getElementById("id_title").value;
                var description = document.getElementById("id_description").value;
              jsonObject.currentProductState = document.querySelector('input[name="current_product_status"]:checked').value;
                var url = "https://vue-server-dev.appspot.com/api/product/" + jsonObject.id;
                if (XMLHttpRequest) {
                    request = new XMLHttpRequest();
                    if ("withCredentials" in request) {
                        // Firefox 3.5 and Safari 4
                        request.open('PUT', url, true);
                        request.setRequestHeader('Custom-Header', 'javascript-client');
                        request.setRequestHeader('Content-Type', 'application/json');
                        request.onreadystatechange = update_handler;
                        //product update request:
                        request.send(JSON.stringify({id: jsonObject.id, ownerAisleId: jsonObject.ownerAisleId, ownerProductListId: jsonObject.ownerProductListId, creatorId: jsonObject.creatorId, curatorId: jsonObject.curatorId, title: title, description: description, currentProductState: jsonObject.currentProductState, relatedProductIds: null, productTags: null, productImages: null, productProviders: null, comments: null, ratings: null}));
                    }
                }

            }

            function update_handler() {
                if (request.readyState != 4)
                    return;
                if (request.status == 200)
                {
                    //updateProvider();
       if (curatorReview == "Curate Now") {
                                    alert('Curated Successfully : '+request.responseText);
                                } else {
                                    alert('Reviewed Successfully :'+request.responseText);
                                }

                                window.opener.close();
                                close();
                }
                if (request.status != 200 && request.status != 304) {
                    //alert('HTTP POST error ' + request.status + 'Response ' + request.responseText);
                    return;
                }
            }

            function updateProvider() {

                var updated_id = document.getElementById('id_' + '0').value;
                var updated_ownerProductId = document.getElementById('ownerProductId_' + '0').value;
                var updated_externalURL = document.getElementById('externalURL_' + '0').value;
                var updated_quantity = document.getElementById('quantity_' + '0').value;
                var updated_currencyCode = document.getElementById('currencyCode_' + '0').value;
                var updated_store = document.getElementById('store_' + '0').value;
                var updated_price = document.getElementById('price_' + '0').value;
                //   var updated_availability = document.getElementById('availability_'+'0');
                // var updated_onSale = document.getElementById('onSale_' + '0').value;
                //  var updated_onSale = $('#onSale_' + '0').val();
                var updated_salePrice = document.getElementById('salePrice_' + '0').value;
                var updated_onSale = document.querySelector('input[name="on_sale_values"]:checked').value


                var updated_saleExpiryDate = document.getElementById('saleExpiryDate_' + '0').value;
                var updated_availableColors = document.getElementById('availableColors_' + '0').value;
                var updated_availableSizes = document.getElementById('availableSizes_' + '0').value;
                var updated_availableAtZipCodes = document.getElementById('availableAtZipCodes_' + '0').value;
                // var updated_availability = $("#availability_" + '0').val();
                var updated_availability = document.querySelector('input[name="provider_Availability"]:checked').value


                var colorArray = updated_availableColors.split(",");
                var sizesArray = updated_availableSizes.split(",");
                var zipcodeArray = updated_availableAtZipCodes.split(",");

                if (updated_store == undefined || updated_store == null || updated_store.length < 1) {
                    alert("Please Fill Store");
                    return;
                }

                if (updated_salePrice == undefined || updated_salePrice == null || updated_salePrice.length < 1) {
                    alert("Please Fill Price");
                    return;
                }

                if (updated_availableColors == undefined || updated_availableColors == null || updated_availableColors.length < 1) {
                    alert("Please Fill Available Colors");
                    return;
                }

                if (updated_availableSizes == undefined || updated_availableSizes == null || updated_availableSizes.length < 1) {
                    alert("Please Fill Available Sizes");
                    return;
                }

                if (updated_availability == undefined || updated_availability == null || updated_availability.length < 1) {
                    alert("Please Fill Availability");
                    return;
                }

                if (updated_currencyCode == undefined || updated_currencyCode == null || updated_currencyCode.length < 1) {
                    alert("Please Fill Currency Code");
                    return;
                }
                var url = "https://vue-server-dev.appspot.com/api/productprovider/" + jsonObject.productProviders[0].id;
                if (XMLHttpRequest) {
                    providerUpdaterequest = new XMLHttpRequest();
                    if ("withCredentials" in providerUpdaterequest) {
                        // Firefox 3.5 and Safari 4
                        providerUpdaterequest.open('PUT', url, true);
                        providerUpdaterequest.setRequestHeader('Custom-Header', 'javascript-client');
                        providerUpdaterequest.setRequestHeader('Content-Type', 'application/json');
                        providerUpdaterequest.onreadystatechange = function providerHandler() {
                            if (providerUpdaterequest.readyState != 4)
                                return;
                             if (providerUpdaterequest.status != 200 && providerUpdaterequest.status != 304) {
                                alert('HTTP POST error ' + providerUpdaterequest.status + 'Response ' + providerUpdaterequest.responseText);
                                return;
                            }
                            if (providerUpdaterequest.status == 200)
                            {
                      
                             curateProduct();
                         
                            }
                          
                        };
                        providerUpdaterequest.send(JSON.stringify({id: jsonObject.productProviders[0].id, ownerProductId: jsonObject.id, externalURL: jsonObject.productProviders[0].externalURL, quantity: updated_quantity, currencyCode: updated_currencyCode, store: updated_store, availability: updated_availability,
                            price: updated_price, onSale: updated_onSale, salePrice: updated_salePrice, saleExpirtyDate: 0, availableColors: colorArray, availableSizes: sizesArray, availableAtZipCodes: zipcodeArray}));
                        //print logs in console        
                        console.log("Provider: " + JSON.stringify({id: jsonObject.productProviders[0].id, ownerProductId: jsonObject.id, externalURL: jsonObject.productProviders[0].externalURL, quantity: updated_quantity, currencyCode: updated_currencyCode, store: updated_store, availability: updated_availability,
                            price: updated_price, onSale: updated_onSale, salePrice: updated_salePrice, saleExpirtyDate: 0, availableColors: colorArray, availableSizes: sizesArray, availableAtZipCodes: zipcodeArray}));
                    }
                }
            }


            function createTagRequest(category, string, subcat) {
 console.log("createTagRequest fun:   CAT:"+category+" Tag String: "+string);
                var url = "https://vue-server-dev.appspot.com/api/producttag";
                if (XMLHttpRequest) {
                    tagCreateRequest = new XMLHttpRequest();
                    if ("withCredentials" in tagCreateRequest) {
                        tagCreateRequest.open('POST', url, true);
                        tagCreateRequest.setRequestHeader('Custom-Header', 'javascript-client');
                        tagCreateRequest.setRequestHeader('Content-Type', 'application/json');
                        tagCreateRequest.onreadystatechange = tagHandler;
                        tagCreateRequest.send(JSON.stringify({tagCategory: category, tagString: string, tagSubCategory: subcat}));
                    }
                }
            }
            function tagHandler() {
                if (tagCreateRequest.readyState != 4)
                    return;
                if (tagCreateRequest.status != 200 && tagCreateRequest.status != 304) {
                    //ToDO: if tag is created already just append to product.  appendtagToProduct  
                    if (appendtagToProduct != undefined) {
                        tagAssociateWithProduct(appendtagToProduct, "tag");
                    }
                    return;
                }
                if (tagCreateRequest.status == 200)
                {
 console.log("createTagRequest fun success:    ");
                    var jsonTagObject = JSON.parse(tagCreateRequest.responseText);
                    tagAssociateWithProduct(jsonTagObject.tagString, "tag");
                }

            }
            var taging;
            function tagAssociateWithProduct(tagString, tag) {
 console.log("tagAssociateWithProduct fun success:    TAGString: "+tagString);
                taging = tag;
                if (tag == "untag") {
                    var position = localTags.indexOf(tagString);
                    if (position != -1) {
                        localTags.splice(position, 1);
                    }
                }
                var url = "https://vue-server-dev.appspot.com/api/product/" + tag + "/" + jsonObject.id + "/" + tagString;
                if (XMLHttpRequest) {
                    productTagAssociateReq = new XMLHttpRequest();
                    if ("withCredentials" in productTagAssociateReq) {
                        // Firefox 3.5 and Safari 4
                        productTagAssociateReq.open('PUT', url, true);
                        productTagAssociateReq.setRequestHeader('Custom-Header', 'javascript-client');
                        productTagAssociateReq.setRequestHeader('Content-Type', 'application/json');
                        productTagAssociateReq.onreadystatechange = tagAssociatHandler;
                        productTagAssociateReq.send();
                    }
                }

            }

            function tagAssociatHandler() {
                if (productTagAssociateReq.readyState != 4)
                    return;
                if (productTagAssociateReq.status != 200 && productTagAssociateReq.status != 304) {
                    alert('HTTP POST error ' + productTagAssociateReq.status + 'Response ' + productTagAssociateReq.responseText);
                    return;
                }
                if (productTagAssociateReq.status == 200)
                {
                     console.log("tagAssociateWithProduct fun success:      ");

                }

            }



            function tagToProduct() {
                var tagString = tagsArray.splice(0, 1);
                if (tagString === undefined || tagString.length < 1) {
                    return;
                }

                var url = "https://vue-server-dev.appspot.com/api/product/tag/" + jsonObject.id + "/" + tagString;
                if (XMLHttpRequest) {
                    tagRequest = new XMLHttpRequest();
                    if ("withCredentials" in tagRequest) {
                        // Firefox 3.5 and Safari 4
                        tagRequest.open('PUT', url, true);
                        tagRequest.setRequestHeader('Custom-Header', 'javascript-client');
                        tagRequest.setRequestHeader('Content-Type', 'application/json');
                        tagRequest.onreadystatechange = tagToProductHandler;
                        tagRequest.send();
                    }
                }

            }

            function tagToProductHandler() {
                if (tagRequest.readyState !== 4)
                    return;
                if (tagRequest.status !== 200 && tagRequest.status !== 304) {
                    alert('HTTP POST error ' + tagRequest.status + 'Response ' + tagRequest.responseText);
                    tagToProduct();
                    return;
                }
                if (tagRequest.status === 200)
                {
                    if (tagsArray.length == 0) {
                        alert("Tags are attached to product");
                    }
                    tagToProduct();
                }

            }

        </script>

        <link rel="stylesheet" type="text/css" href="src/jquery.multiselect.css" />
        <link rel="stylesheet" type="text/css" href="src/jquery.multiselect.filter.css" />
        <link rel="stylesheet" type="text/css" href="assets/style.css" />
        <link rel="stylesheet" type="text/css" href="assets/prettify.css" />
        <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/ui-lightness/jquery-ui.css" />
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1/jquery-ui.min.js"></script>
        <script type="text/javascript" src="src/jquery.multiselect.js"></script>
        <script type="text/javascript" src="src/jquery.multiselect.filter.js"></script>
        <script type="text/javascript" src="assets/prettify.js"></script>

        <script type="text/javascript">

            function addTagsToTableVaz() {

                var valC = $("#select_tagCategory").val();
                var valS = $("#select_tagString").val();
                var valSC = $("#select_tagSubCategory").val();
                //for Product Type
                if (valC !== null && valC !== undefined && valC !== '') {
                    var productType = valC;
                    for (var p = 0; p < productType.length; p++) {


                        for (var q = 0; q < tags.length; q++) {
                            var cat = tags[q].tagCategory;
                            var tagstr = tags[q].tagString;
                            var tagSubStr = tags[q].tagSubCategory;
                            if (cat !== null && cat !== undefined && cat.indexOf('Product Type') === 0 && tagstr.indexOf(productType[p]) === 0) {

                                addElementToTable('Product Type', tagstr, tagSubStr);
                                tagsArray.push(tagstr);
                            }
                        }

                    }
                }


                //for Occasion
                if (valS !== null && valS !== undefined && valS !== '') {
                    var productType = valS;
                    for (var p = 0; p < productType.length; p++) {


                        for (var q = 0; q < tags.length; q++) {

                            var cat = tags[q].tagCategory;
                            var tagstr = tags[q].tagString;
                            var tagSubStr = tags[q].tagSubCategory;
                            if (cat !== null && cat !== undefined && cat.indexOf('Occasion') === 0 && tagstr.indexOf(productType[p]) === 0) {

                                addElementToTable('Occasion', tagstr, tagSubStr);
                                tagsArray.push(tagstr);
                            }
                        }

                    }
                }

                //for Product description
                if (valSC !== null && valSC !== undefined && valSC !== '') {
                    var productType = valSC;
                    for (var p = 0; p < productType.length; p++) {

                        for (var q = 0; q < tags.length; q++) {
                            var cat = tags[q].tagCategory;
                            var tagstr = tags[q].tagString;
                            var tagSubStr = tags[q].tagSubCategory;
                            if (cat !== null && cat !== undefined && cat.indexOf('Product description') === 0 && tagstr.indexOf(productType[p]) === 0) {

                                addElementToTable('Product description', tagstr, tagSubStr);
                                tagsArray.push(tagstr);
                            }
                        }

                    }
                }


                //create TAG.
                //   createTagRequest(valC, tagString, subCatString);
                tagToProduct();
            }

            function addElementToTable(cat, str, substr) {

                createTagReqAndAddTable(cat, str, substr, 0);

            }

            function createCustomTag() {
                var valC, valS, valSC;
                valC = document.getElementById("id_tag_cat").value;
                valS = document.getElementById("id_tag_str").value;
                valSC = document.getElementById("id_sub_str").value;
                if (valS == null || valS.length < 1 || valS == undefined) {
                    alert("Tag String must not empty");
                    return;
                }
                if (valC == null || valC.length < 1 || valC == undefined) {
                    alert("Tag Category must not empty");
                    return;
                }
                document.getElementById("id_tag_str").value = "";
                console.log("CAT:"+valC+" Tag String: "+valS);
                createTagReqAndAddTable(valC, valS, valSC, 1);
            }

            function createTagReqAndAddTable(valC, valS, valSC, addtableonly) {
                var row = document.createElement('tr');
                var thC = document.createElement('th');
                thC.textContent = valC;
                var thS = document.createElement('th');
                thS.textContent = valS;
                var thSC = document.createElement('th');
                thSC.textContent = valSC;
                var del = document.createElement('th')
                var btn = document.createElement('Button');
                btn.textContent = 'Untag';
                btn.onclick = function() {
                    document.getElementById('created_tags_table').removeChild(row);

                    tagAssociateWithProduct(valS, "untag");
                };
                del.appendChild(btn);
                row.appendChild(thC);
                row.appendChild(thS);
                row.appendChild(thSC);
                row.appendChild(del);
                document.getElementById('created_tags_table').appendChild(row);

                appendtagToProduct = valS;

                if (valSC === undefined)
                    valSC === null;

                //to attach local data

                localTags.push(valS);
                if (addtableonly === 1)
                    createTagRequest(valC, valS, valSC)
            }


            function  createGenderTag() {

                var vl = document.querySelector('input[name="que_1"]:checked').value;
                tagsArray.push(vl);
                createTagReqAndAddTable('Product description', vl, '', 0);
                tagToProduct();
            }
        </script>
    </head>
    <body onblur="window.focus()" onload="prettyPrint();" >

        <form action="" method="post" class="smart-green">
            <h1>
                Product Information <span>Please fill all the texts in the
                    fields.</span>
            </h1>
            <label> <span>id: </span> <input id="id_id" type="text"
                                             name="name" placeholder="Id of the product" readonly="readonly" />
            </label> <label> <span>ownerAisleId: </span> <input id="id_ownerAisleId"
                                                                type="text" name="name" placeholder="Id of the owner aisle" readonly="readonly"/>
            </label> <label> <span>ownerProductListId: </span> <input id="id_ownerProductListId"
                                                                      type="text" name="name" placeholder="Id of the owner product" readonly="readonly"/>
            </label> <label> <span>title: </span> <input id="id_title" type="text" name="name" placeholder="Title of the product" />
            </label> <label> <span>description: </span> <textarea id="id_description"
                                                                  name="name" placeholder="Description of the product"></textarea>
            </label> <label> <span>creatorID: </span> <input id="id_creatorID" type="text"
                                                             name="name" placeholder="Id of the product creator" readonly="readonly"/>
            </label> <label> <span>curatorID: </span> <input id="id_curatorID" type="text"
                                                             name="name" placeholder="Id of the product curator" readonly="readonly"/>
            </label> <label> <span>currentProductState: </span> 

                <!--                <select id="single_select_1" name="selection" onchange="myNewFunction(this.value)"   style="width: 300px">
                
                                </select>-->
                <br><br>
                <di id="single_select_1" ></di>

                </select>

            </label> <label> <span>relatedProductIds: </span> <input id="id_relatedProductIds"
                                                                     type="text" name="name" placeholder="List of related products" readonly="readonly"/>
            </label> <label> <span>comments: </span> <input id="id_comments" type="text"
                                                            name="name" placeholder="Comments of the product" />
            </label> <label> <span>ratings: </span> <input id="id_ratings" type="text"
                                                           name="name" placeholder="Rating of the product" />

            </label> <label> <span><strong>ProductImages: </strong></span> </label>

            <div id="image_table_id"></div>

            <br> <br> <label> <span><strong>productTags:

                    </strong></span>

            </label> <br> <br>


            <table class="altrowstable" id="created_tags_table" width="600">
                <caption>Tags Created</caption>

                <tr>
                    <th><strong>Tag Category:</strong>
                    </th>
                    <th><strong>Tag String:</strong>
                    </th>
                    <th><strong>Tag Sub Category:</strong>                      
                    </th>
                    <th><strong>Tag Deletion:</strong>                      
                    </th>
                </tr>
            </table>



            <table class="altrowstable" id="alternatecolor"  width="600">

                <caption>we can create tags from here</caption>

                <tr>
                    <th><strong>Product Type:</strong>

                        <select id="select_tagCategory" name="selection" multiple="multiple"  style="width: 200px">

                        </select>
                    </th>
                    <th><strong>Occasion:</strong>
                <div style="padding:20px">
                    <select id="select_tagString" name="selection"  multiple="multiple"  style="width: 200px" data-native-menu="false">

                    </select>
                </div>

                </th>
                <th><strong>Product description:</strong>
                <div style="padding:20px">
                    <select id="select_tagSubCategory" name="selection" multiple="multiple"   style="width: 200px" data-native-menu="false">


                    </select>
                </div>

                </th>

                </tr>

            </table>

            <input type="button" class="button" value="Create Tag" onclick="addTagsToTableVaz()" />

            <br><br><br>

            <label for="id_tag_cat"> <span>Tag Category </span> <input id="id_tag_cat"
                                                                       type="text" name="name"  />

                <script type="text/javascript">

                    $(function() {
                        var availableTags = [
                            "Product Type",
                            "Occasion",
                            "Product description",
                        ];
                        $("#id_tag_cat").autocomplete({
                            source: availableTags,
                            minLength: 0,
                        }).focus(function() {
                            //Use the below line instead of triggering keydown
                            $(this).autocomplete('search');
                        });
                    });


                </script>

            </label>
            <label> <span>Tag String </span> <input id="id_tag_str"
                                                    type="text" name="name"  />
            </label>
            <label> <span>Tag Sub Category </span> <input id="id_sub_str"
                                                          type="text" name="name"  />
            </label>

            <label> <span>&nbsp;</span> <input type="button"
                                               class="button" value="Create&Attach Custom Tag" onclick="createCustomTag()"  /></label>



            <br><br>
            <table class="altrowstable" id="alternatecolor"  width="600">

                <caption><strong>Add Gender Tag</strong><caption>

                        <tr>

                            <th><strong>Product description:</strong>
                        <div style="padding:20px">
                            <td >
                                <label>
                                    <input type="radio" id="r1" name='que_1' value="Male" />
                                    Male<br>
                                </label>
                                <label>
                                    <input type="radio" id="r2" name='que_1' value="Female" />
                                    Female<br>
                                </label>

                                <label>
                                    <input type="radio" id="r3" name='que_1' value="Unisex" />
                                    Unisex<br>
                                </label>
                            </td>
                            <td>
                                <input type="button"
                                       class="button" value="Create Gender Tag" onclick="createGenderTag()"  />

                            </td>
                        </div>


                        </th>

                        </tr>

                        </table>


                        <br> <br>
                        <label> <span><strong>productProviders:
                                </strong></span></label>
                        <div id ="product_providers_div_id"></div>

                        <label> <span>&nbsp;</span> <input type="button"
                                                           class="button" value="Curate and Finish" onClick="updateProvider()" id ="send_but_id"/>
                        </label>
                        </form>
                        </body>


                        </html>
